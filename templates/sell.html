{% extends 'base.html' %}
{% block content %}
<a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">‚Üê Back to Product List</a>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="POST">
  <div class="mb-3">
    <label>Select Product</label>
    <select name="product_id" id="productSelect" class="form-select" onchange="updateSizes(this)">
      <option value="" selected disabled>Select a product</option>
      {% for product in products %}
        <option value="{{ product.id }}" data-image="{{ product.image_url }}">
          Product #{{ product.id }} - ${{ "%.2f"|format(product.selling_price) }}
        </option>
      {% endfor %}
    </select>
    <div class="mt-3">
      <img id="productImage" src="" class="img-fluid rounded" style="max-height: 250px; display: none;" alt="Selected product image">
    </div>
        
  </div>

  <div class="mb-3">
    <label>Select Size</label>
    <select name="size" id="sizeDropdown" class="form-select" required>
      <option value="">-- Select a size --</option>
    </select>
  </div>

  <button class="btn btn-primary">Sell Item</button>
</form>

<script>
function updateSizes(selectElement) {
  const selectedOption = selectElement.options[selectElement.selectedIndex];
  const sizeDropdown = document.getElementById('sizeDropdown');
  sizeDropdown.innerHTML = '<option value="">-- Select a size --</option>';

  if (selectedOption && selectedOption.dataset.sizes) {
    const sizes = selectedOption.dataset.sizes.split(',');
    for (const size of sizes) {
      const option = document.createElement('option');
      option.value = size;
      option.text = size;
      sizeDropdown.appendChild(option);
    }
  }
}
</script>

<script>
  document.getElementById('productSelect').addEventListener('change', function() {
    const selectedOption = this.options[this.selectedIndex];
    const imageUrl = selectedOption.getAttribute('data-image');
    const imageEl = document.getElementById('productImage');
  
    if (imageUrl) {
      imageEl.src = imageUrl;
      imageEl.style.display = 'block';
    } else {
      imageEl.style.display = 'none';
    }
  });
  </script>
  
{% endblock %}
