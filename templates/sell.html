{% extends 'base.html' %}
{% block content %}
<a href="{{ url_for('index') }}" class="btn btn-secondary mb-3">← Back to Product List</a>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
      <div class="alert alert-{{ category }}">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<form method="POST">
  <div class="mb-3">
    <label>Select Product</label>
    <select name="product_id" class="form-select" required onchange="updateSizes(this)">
      <option value="">-- Select a product --</option>
      {% for product in products %}
        <option value="{{ product.id }}" data-sizes="{% for sq in product.sizes %}{{ sq.size }}{% if not loop.last %},{% endif %}{% endfor %}">
          Product #{{ product.id }} – {{ product.style_url }}
        </option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label>Select Size</label>
    <select name="size" id="sizeDropdown" class="form-select" required>
      <option value="">-- Select a size --</option>
    </select>
  </div>

  <button class="btn btn-primary">Sell Item</button>
</form>

<script>
function updateSizes(selectElement) {
  const selectedOption = selectElement.options[selectElement.selectedIndex];
  const sizeDropdown = document.getElementById('sizeDropdown');
  sizeDropdown.innerHTML = '<option value="">-- Select a size --</option>';

  if (selectedOption && selectedOption.dataset.sizes) {
    const sizes = selectedOption.dataset.sizes.split(',');
    for (const size of sizes) {
      const option = document.createElement('option');
      option.value = size;
      option.text = size;
      sizeDropdown.appendChild(option);
    }
  }
}
</script>
{% endblock %}
