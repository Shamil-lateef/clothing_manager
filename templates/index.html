{% extends 'base.html' %}
{% block content %}
<a href="{{ url_for('search_by_size') }}" class="btn btn-info mb-3">üîç Search by Size</a>

<a href="{{ url_for('sell_product') }}" class="btn btn-warning mb-3">Sell a Product</a>

<a href="{{ url_for('add_product') }}" class="btn btn-success mb-3">+ Add New Product</a>
<div class="row row-cols-1 row-cols-md-2 g-4">
    {% for product in products %}
    <div class="col">
      <div class="card h-100">
        <img src="{{ product.image_url }}" class="img-fluid mb-2" alt="Product Image">

        <div class="card-body">
          <h5 class="card-title"><a href="{{ product.style_url }}" target="_blank">View Style</a></h5>
          <p><strong>Selling Price:</strong> IQD{{ product.selling_price }}</p>
          <p><strong>Stock:</strong></p>
          <ul>
            {% for sq in product.sizes %}
              <li {% if sq.quantity <= 1 %} style="color: red; font-weight: bold;" {% endif %}>
                Size {{ sq.size }}:   {{ sq.quantity }}   sets available
                {% if sq.quantity <= 1 %} ‚ö†Ô∏è Low Stock {% endif %}
              </li>
            {% endfor %}
          </ul>
          
          {% if low_stock_items %}
            <div class="alert alert-warning">
                <h5>‚ö†Ô∏è Low Stock Alerts:</h5>
                <ul>
                {% for item in low_stock_items %}
                    <li>
                    Product #{{ item.product.id }} ‚Äî Size: {{ item.size }} (Only {{ item.quantity }} left)
                    </li>
                {% endfor %}
                </ul>
            </div>
            {% endif %}

          <a href="{{ url_for('edit_product', product_id=product.id) }}" class="btn btn-sm btn-warning me-2">Edit</a>

            <form action="{{ url_for('delete_product', product_id=product.id) }}" method="POST" style="display:inline-block;" onsubmit="return confirm('Are you sure?');">
            <button class="btn btn-sm btn-danger">Delete</button>
            </form>

        </div>
      </div>
    </div>
  {% endfor %}
  
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
